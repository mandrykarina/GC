cmake_minimum_required(VERSION 3.10)
project(GC_Unified)

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚ C++
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)

# Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼Ñ‹Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸
include_directories(
    ${CMAKE_SOURCE_DIR}
    ${CMAKE_SOURCE_DIR}/reference_counting/include
    ${CMAKE_SOURCE_DIR}/mark_sweep/include
)

# ============================================
# ĞĞ‘Ğ©Ğ˜Ğ• Ğ¤ĞĞ™Ğ›Ğ« (Ğ’Ğ«ĞĞ•Ğ¡Ğ•ĞĞĞ«Ğ• Ğ˜Ğ— MAIN)
# ============================================
set(COMMON_SOURCES
    common_utils.cpp
    wrapper.cpp
)

# ============================================
# REFERENCE COUNTING - Ğ¤ĞĞ™Ğ›Ğ«
# ============================================
set(RC_SOURCES
    reference_counting/src/main.cpp
    reference_counting/src/rc_heap.cpp
    reference_counting/src/reference_counter.cpp
    reference_counting/src/event_logger.cpp
    reference_counting/src/scenario_loader.cpp
    reference_counting/src/rc_logger.cpp
)

# ============================================
# MARK & SWEEP - Ğ¤ĞĞ™Ğ›Ğ«
# ============================================
set(MS_SOURCES
    mark_sweep/src/main.cpp
    mark_sweep/src/cascade_deletion_gc.cpp
    mark_sweep/src/mark_sweep_gc.cpp
    mark_sweep/src/performance_test.cpp
)

# ============================================
# Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ Ğ˜Ğ¡ĞŸĞĞ›ĞĞ¯Ğ•ĞœĞ«Ğ™ Ğ¤ĞĞ™Ğ›
# ============================================
add_executable(gc_unified
    main.cpp
    ${COMMON_SOURCES}
    ${RC_SOURCES}
    ${MS_SOURCES}
)

# ĞĞ¿Ñ†Ğ¸Ğ¸ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
if(MSVC)
    target_compile_options(gc_unified PRIVATE /W4 /O2)
else()
    target_compile_options(gc_unified PRIVATE -Wall -Wextra -O2 -Wno-unused-parameter)
endif()

# ============================================
# Ğ˜ĞĞ¤ĞĞ ĞœĞĞ¦Ğ˜Ğ¯ Ğ Ğ¡Ğ‘ĞĞ ĞšĞ•
# ============================================
message(STATUS "")
message(STATUS "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
message(STATUS "â•‘                  GC UNIFIED - CMAKE CONFIGURATION                   â•‘")
message(STATUS "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£")
message(STATUS "â•‘ Project: ${PROJECT_NAME}")
message(STATUS "â•‘ C++ Standard: C++17")
message(STATUS "â•‘ Build Type: ${CMAKE_BUILD_TYPE}")
message(STATUS "â•‘ Source Dir: ${CMAKE_SOURCE_DIR}")
message(STATUS "â•‘ Build Dir: ${CMAKE_BINARY_DIR}")
message(STATUS "â•‘ Output: ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/gc_unified")
message(STATUS "â•‘")
message(STATUS "â•‘ ğŸ“¦ COMMON UTILITIES (ĞĞ‘Ğ©Ğ˜Ğ• Ğ¤ĞĞ™Ğ›Ğ«):") 
message(STATUS "â•‘    - common_utils.h/.cpp (Ğ¾Ğ±Ñ‰Ğ¸Ğµ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸)")
message(STATUS "â•‘      â€¢ MemoryStats, MemoryConfig, Operation, ParsedScenario")
message(STATUS "â•‘      â€¢ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸")
message(STATUS "â•‘      â€¢ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸ Ğ¸ JSON")
message(STATUS "â•‘")
message(STATUS "â•‘ ğŸ“¦ Reference Counting (RC):")
message(STATUS "â•‘    - reference_counting/src/main.cpp")
message(STATUS "â•‘    - reference_counting/src/rc_heap.cpp")
message(STATUS "â•‘    - reference_counting/src/rc_heap.h")
message(STATUS "â•‘    - reference_counting/src/rc_logger.cpp âœ¨ ĞĞĞ’Ğ«Ğ™")
message(STATUS "â•‘    - reference_counting/src/rc_logger.h âœ¨ ĞĞĞ’Ğ«Ğ™")
message(STATUS "â•‘    - reference_counting/src/reference_counter.cpp")
message(STATUS "â•‘    - reference_counting/src/event_logger.cpp")
message(STATUS "â•‘    - reference_counting/src/scenario_loader.cpp")
message(STATUS "â•‘    â†’ Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ² Ñ„Ğ°Ğ¹Ğ» Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Mark-Sweep!")
message(STATUS "â•‘")
message(STATUS "â•‘ ğŸ“¦ Mark & Sweep (MS):")
message(STATUS "â•‘    - mark_sweep/src/main.cpp")
message(STATUS "â•‘    - mark_sweep/src/cascade_deletion_gc.cpp")
message(STATUS "â•‘    - mark_sweep/src/mark_sweep_gc.cpp")
message(STATUS "â•‘    - mark_sweep/src/performance_test.cpp")
message(STATUS "â•‘")
message(STATUS "â•‘ âœ¨ Ğ§Ğ¢Ğ ĞĞĞ’ĞĞ“Ğ Ğ’ Ğ­Ğ¢ĞĞ™ Ğ’Ğ•Ğ Ğ¡Ğ˜Ğ˜:")
message(STATUS "â•‘    âœ… RCLogger - Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€ Ğ´Ğ»Ñ Reference Counting")
message(STATUS "â•‘    âœ… Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ² Ñ„Ğ°Ğ¹Ğ» [Step N] Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ, ĞºĞ°Ğº Mark-Sweep")
message(STATUS "â•‘    âœ… ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚:")
message(STATUS "â•‘       â€¢ ALLOCATE Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ°Ğ¼Ğ¸ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²")
message(STATUS "â•‘       â€¢ MAKE_ROOT / REMOVE_ROOT")
message(STATUS "â•‘       â€¢ ADD_REF / REMOVE_REF")
message(STATUS "â•‘       â€¢ Cascade deletion")
message(STATUS "â•‘       â€¢ Ğ£Ñ‚ĞµÑ‡ĞºĞ¸ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ (LEAKs)")
message(STATUS "â•‘    âœ… Ğ¡ĞµÑÑĞ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ¼Ğ°Ñ€ĞºĞµÑ€Ñ‹ Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°/ĞºĞ¾Ğ½Ñ†Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹")
message(STATUS "â•‘")
message(STATUS "â•‘ ğŸ”§ ĞšĞĞœĞŸĞ˜Ğ›Ğ¯Ğ¦Ğ˜Ğ¯:")
message(STATUS "â•‘    - ĞĞ¿Ñ†Ğ¸Ğ¸: -Wall -Wextra -O2 -Wno-unused-parameter")
message(STATUS "â•‘    - ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¾ Ğ½ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ñ… Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°Ñ…")
message(STATUS "â•‘    - Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ° Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ O2")
message(STATUS "â•‘")
message(STATUS "â•‘ ğŸ“Š Ğ’Ğ¡Ğ•Ğ“Ğ Ğ˜Ğ¡Ğ¥ĞĞ”ĞĞ«Ğ¥ Ğ¤ĞĞ™Ğ›ĞĞ’:")
message(STATUS "â•‘    - Common: 2 Ñ„Ğ°Ğ¹Ğ»Ğ°")
message(STATUS "â•‘    - Reference Counting: 7 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (+ rc_logger.h/.cpp)")
message(STATUS "â•‘    - Mark & Sweep: 4 Ñ„Ğ°Ğ¹Ğ»Ğ°")
message(STATUS "â•‘    - Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ main.cpp: 1 Ñ„Ğ°Ğ¹Ğ»")
message(STATUS "â•‘    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
message(STATUS "â•‘    Ğ˜Ğ¢ĞĞ“Ğ: 14 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²")
message(STATUS "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
message(STATUS "")